<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>API集成 | 好记性不如烂笔头</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">API集成</h1><a id="logo" href="/.">好记性不如烂笔头</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">API集成</h1><div class="post-meta">Jul 4, 2016<span> | </span><span class="category"><a href="/categories/Python/">Python</a></span></div><div class="post-content"><h1 id="使用-requests-访问-Web-APIs"><a href="#使用-requests-访问-Web-APIs" class="headerlink" title="使用 requests 访问 Web APIs"></a>使用 requests 访问 Web APIs</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line">gh_url = &apos;https://api.github.com&apos;</span><br><span class="line"></span><br><span class="line">req = urllib2.Request(gh_url)</span><br><span class="line"></span><br><span class="line">password_manager = urllib2.HTTPPasswordMgrWithDefaultRealm()</span><br><span class="line">password_manager.add_password(None, gh_url, &apos;user&apos;, &apos;pass&apos;)</span><br><span class="line"></span><br><span class="line">auth_manager = urllib2.HTTPBasicAuthHandler(password_manager)</span><br><span class="line">opener = urllib2.build_opener(auth_manager)</span><br><span class="line"></span><br><span class="line">urllib2.install_opener(opener)</span><br><span class="line"></span><br><span class="line">handler = urllib2.urlopen(req)</span><br><span class="line"></span><br><span class="line">print handler.getcode()</span><br><span class="line">print handler.headers.getheader(&apos;content-type&apos;)</span><br><span class="line"></span><br><span class="line"># ------</span><br><span class="line"># 200</span><br><span class="line"># &apos;application/json&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.get(&apos;https://api.github.com&apos;, auth=(&apos;user&apos;, &apos;pass&apos;))</span><br><span class="line"></span><br><span class="line">print r.status_code</span><br><span class="line">print r.headers[&apos;content-type&apos;]</span><br><span class="line"></span><br><span class="line"># ------</span><br><span class="line"># 200</span><br><span class="line"># &apos;application/json&apos;</span><br></pre></td></tr></table></figure>
<p>显而易见，用requests模块更省事。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">u&apos;[&#123;&quot;created_at&quot;:&quot;2014-06-08T20:50:27-07:00&quot;,&quot;payload&quot;:&#123;&quot;sha...</span><br><span class="line">Requests will automatically decode content from the server. The text encoding guessed by Requests is used when you access r.text. You can find out what encoding Requests is using, and change it, using the r.encoding property:</span><br><span class="line"></span><br><span class="line">&apos;utf-8&apos;</span><br><span class="line">There&apos;s an builtin JSON decoder on which we heavily rely on</span><br><span class="line"></span><br><span class="line">[&#123;u&apos;actor_attributes&apos;: &#123;u&apos;name&apos;: u&apos;Tin...</span><br><span class="line"></span><br><span class="line">payload = &#123;&apos;key1&apos;: &apos;value1&apos;, &apos;key2&apos;: &apos;value2&apos;&#125;</span><br><span class="line">You can see that the URL has been correctly encoded by printing the URL:</span><br><span class="line"></span><br><span class="line">http://httpbin.org/get?key2=value2&amp;key1=value1</span><br></pre></td></tr></table></figure>
<p>你也可以自定义你的Headers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> r = requests.get(&apos;http://httpbin.org/get&apos;)</span><br><span class="line">200</span><br><span class="line"></span><br><span class="line">404</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File &quot;requests/models.py&quot;, line 832, in raise_for_status</span><br><span class="line">    raise http_error</span><br><span class="line">requests.exceptions.HTTPError: 404 Client Error</span><br><span class="line">Response.raise_for_status() returns None for status_code 200</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">r.headers</span><br><span class="line">&#123;</span><br><span class="line">    &apos;content-encoding&apos;: &apos;gzip&apos;,</span><br><span class="line">    &apos;transfer-encoding&apos;: &apos;chunked&apos;,</span><br><span class="line">    &apos;connection&apos;: &apos;close&apos;,</span><br><span class="line">    &apos;server&apos;: &apos;nginx/1.0.4&apos;,</span><br><span class="line">    &apos;x-runtime&apos;: &apos;148ms&apos;,</span><br><span class="line">    &apos;etag&apos;: &apos;&quot;e1ca502697e5c9317743dc078f67693f&quot;&apos;,</span><br><span class="line">    &apos;content-type&apos;: &apos;application/json&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&apos;application/json&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">requests.get(&apos;http://github.com&apos;, timeout=0.001)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">requests.exceptions.Timeout: Request timed out.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n [3]: url = &apos;https://api.github.com/users/sayanchowdhury/repos?page=1&amp;per_page</span><br><span class="line">   ...: =10&apos;</span><br><span class="line">   ...: r = requests.head(url=url)</span><br><span class="line">   ...: </span><br><span class="line"></span><br><span class="line">In [4]: </span><br><span class="line"></span><br><span class="line">In [4]: r.links</span><br><span class="line">Out[4]: </span><br><span class="line">&#123;&apos;last&apos;: &#123;&apos;rel&apos;: &apos;last&apos;,</span><br><span class="line">  &apos;url&apos;: &apos;https://api.github.com/user/500628/repos?page=11&amp;per_page=10&apos;&#125;,</span><br><span class="line"> &apos;next&apos;: &#123;&apos;rel&apos;: &apos;next&apos;,</span><br><span class="line">  &apos;url&apos;: &apos;https://api.github.com/user/500628/repos?page=2&amp;per_page=10&apos;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://docs.python-requests.org/zh_CN/latest/user/quickstart.html" target="_blank" rel="noopener">http://docs.python-requests.org/zh_CN/latest/user/quickstart.html</a></p>
</div><div class="tags"><a href="/tags/Web/">Web</a></div><div class="post-nav"><a class="pre" href="/2016/08/03/WEB开放模式/">WEB设计模式</a><a class="next" href="/2016/07/02/Python技巧/">Python实践</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://iusepython.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/FrontEnd/">FrontEnd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spider/">Spider</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/sqlalchemy/" style="font-size: 15px;">sqlalchemy</a> <a href="/tags/FrontEnd/" style="font-size: 15px;">FrontEnd</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/ELK/" style="font-size: 15px;">ELK</a> <a href="/tags/Deploy/" style="font-size: 15px;">Deploy</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/IDE/" style="font-size: 15px;">IDE</a> <a href="/tags/Database/" style="font-size: 15px;">Database</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/Ubuntu/" style="font-size: 15px;">Ubuntu</a> <a href="/tags/Virtualenv/" style="font-size: 15px;">Virtualenv</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a> <a href="/tags/Html/" style="font-size: 15px;">Html</a> <a href="/tags/Node-js/" style="font-size: 15px;">Node.js</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Spider/" style="font-size: 15px;">Spider</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/Webpack/" style="font-size: 15px;">Webpack</a> <a href="/tags/zsh/" style="font-size: 15px;">zsh</a> <a href="/tags/Others/" style="font-size: 15px;">Others</a> <a href="/tags/du-df/" style="font-size: 15px;">du / df</a> <a href="/tags/DA/" style="font-size: 15px;">DA</a> <a href="/tags/Socket/" style="font-size: 15px;">Socket</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/17/ELK/">ELK stack</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/29/docker-compose/">docker-compose的语法和命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/17/快速查看大文件位置/">快速定位大文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/17/SSH config使用教程/">SSH config使用教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/17/nginx的负载均衡/">Nginx负载均衡</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/17/nginx的proxy_pass详解/">Nginx配置本地域名路由</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/17/查看文件大小/">Nginx配置本地域名路由</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/17/网络概念整理/">网络概念整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/17/Git Rebase/">Git Rebase</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/17/nginx配置本地域名路由/">Nginx配置本地域名路由</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://github.com/fanhaipeng0403" title="Github" target="_blank">Github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">好记性不如烂笔头.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>